#!/usr/bin/env node

var Firebase = require('firebase');
var firework = require('../lib');

var argv = require('optimist')
  .usage('Manage a firework instance\nUsage: firework create-worker.js [ -w numWorkers ]')
  .options('w', { describe: 'The number of workers to run', default: 1 })
  .argv;

if (argv._.length !== 1) {
  console.error('Usage: firework create-worker.js [ -w numWorkers ]');
  process.exit(1);
}

var workerFile = require('path').join(process.cwd(), argv._[0]);
var createWorker = require(workerFile);
var runner = new firework.Runner(createWorker);

runner.setNumberOfWorkers(argv.w);

process.once('QUIT', function () {
  console.log('QUIT received, gracefully stopping all workers');

  runner.stopAllWorkers(function () {
    process.exit();
  });
});
